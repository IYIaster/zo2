var ZO2AdminMegamenu=window.ZO2AdminMegamenu||{};!function(d){var b=null,f,h,e,a,c;d.fn.megamenuAdmin=function(j){var i={};var j=d.extend(i,j);f=d(this).find(".zo2-megamenu");h=f.find('ul[class*="level"]>li>:first-child');e=f.find(".menu-child");a=f.find('[class*="span"]');c=h.add(e).add(a);h.each(function(){var k=d(this),l=k.closest("li");if(l.data("hidesub")==1){var m=l.find(".menu-child:first");m.css("display","none");k.removeClass("dropdown-toggle").data("toggle","");l.removeClass("dropdown dropdown-submenu mega")}});hide_toolbox(true);bindEvents(c);d(".toolbox-action, .toolbox-toggle, .toolbox-input").unbind("focus blur click change keydown");d(".zo2-admin-mm-row").click(function(k){k.stopPropagation()});d(document.body).click(function(k){hide_toolbox(true)});d(".toolbox-action").click(function(k){var l=d(this).data("action");if(l){g.datas=d(this).data();g[l]()}k.stopPropagation();return false});d(".toolbox-toggle").change(function(k){var l=d(this).data("action");if(l){g.datas=d(this).data();g[l]()}k.stopPropagation();return false});d(".toolbox-input").bind("focus blur click",function(k){k.stopPropagation();return false});d(".toolbox-input").bind("keydown",function(k){if(k.keyCode=="13"){apply_toolbox(this);k.preventDefault()}});d(".toolbox-input").change(function(k){apply_toolbox(this);k.stopPropagation();return false});return this};var g={};g.data={};g.toggleSub=function(){if(!b){return}var i=b.closest("li"),j=i.find(".menu-child:first");if(i.data("group")){return}if(j.length==0||j.css("display")=="none"){if(j.length==0){j=d('<div class="menu-child  dropdown-menu mega-dropdown-menu"><div class="row-fluid"><div class="span12" data-width="12"><div class="mega-inner"></div></div></div></div>').appendTo(i);bindEvents(j.find('[class*="span"]'));i.addClass("mega")}else{j.css("display","");i.data("hidesub",0)}i.data("group",0);b.addClass("dropdown-toggle").data("toggle","dropdown");i.addClass(i.data("level")==1?"dropdown":"dropdown-submenu");bindEvents(j)}else{unbindEvents(j);if(i.find("ul.level"+i.data("level")).length>0){j.css("display","none");i.data("hidesub",1)}else{j.remove()}i.data("group",0);b.removeClass("dropdown-toggle").data("toggle","");i.removeClass("dropdown dropdown-submenu mega")}update_toolbox()};g.toggleGroup=function(){if(!b){return}var i=b.parent(),j=i.find(".menu-child:first");if(i.data("level")==1){return}if(i.data("group")){i.data("group",0);i.removeClass("mega-group").addClass("dropdown-submenu");b.addClass("dropdown-toggle").data("toggle","dropdown");j.removeClass("mega-group-content").addClass("dropdown-menu mega-dropdown-menu");j.css("width",j.data("width"));rebindEvents(j)}else{b.removeClass("dropdown-toggle").data("toggle","");i.data("group",1);i.removeClass("dropdown-submenu").addClass("mega-group");j.removeClass("dropdown-menu mega-dropdown-menu").addClass("mega-group-content");j.css("width","");rebindEvents(j)}update_toolbox()};g.moveItemsLeft=function(){if(!b){return}var u=b.closest("li"),j=u.parent().closest("li"),k=j.data("level"),s=u.closest('[class*="span"]'),p=s.find("ul:first > li"),i=p.index(u),r=p.slice(0,i+1),t=p.length-r.length,v=s.parent().parent().children('[class*="row"]'),o=v.children('[class*="span"]').filter(function(){return !d(this).data("module_id")}),m=o.index(s);if(!j.length){return}if(m==0){var q=b;b=s;g.datas.addfirst=true;g.addColumn();o=v.children('[class*="span"]').filter(function(){return !d(this).data("module_id")});b=q;m++}var l=d(o[m-1]);var n=l.find("ul:first");if(!n.length){n=d('<ul class="mega-nav level'+k+'">').appendTo(l.children(".mega-inner"))}r.appendTo(n);if(t==0){s.find("ul:first").remove()}update_toolbox()};g.moveItemsRight=function(){if(!b){return}var u=b.closest("li"),j=u.parent().closest("li"),k=j.data("level"),s=u.closest('[class*="span"]'),p=s.find("ul:first > li"),i=p.index(u),r=p.slice(i),t=p.length-r.length,v=s.parent().parent().children('[class*="row"]'),o=v.children('[class*="span"]').filter(function(){return !d(this).data("module_id")}),m=o.index(s);if(!j.length){return}if(m==o.length-1){var q=b;b=s;g.datas.addfirst=false;g.addColumn();o=v.children('[class*="span"]').filter(function(){return !d(this).data("module_id")});b=q}var l=d(o[m+1]);var n=l.find("ul:first");if(!n.length){n=d('<ul class="mega-nav level'+k+'">').appendTo(l.children(".mega-inner"))}r.prependTo(n);if(t==0){s.find("ul:first").remove()}show_toolbox(b)};g.addRow=function(){if(!b){return}var i=d('<div class="row-fluid"><div class="span12"><div class="mega-inner"></div></div></div>').appendTo(b.find(".mega-dropdown-inner")),j=i.children();bindEvents(j);b=null;show_toolbox(j)};g.alignment=function(){var i=b.closest("li");i.removeClass("mega-align-left mega-align-center mega-align-right mega-align-justify").addClass("mega-align-"+g.datas.align);if(g.datas.align=="justify"){b.addClass("span12");b.css("width","")}else{b.removeClass("span12");if(b.data("width")){b.css("width",b.data("width"))}}i.data("alignsub",g.datas.align);update_toolbox()};g.addColumn=function(){if(!b){return}var j=b.parent().children('[class*="span"]'),i=j.length+1,l=defaultColumnsWidth(i);var k=d('<div><div class="mega-inner"></div></div>');if(g.datas.addfirst){k.prependTo(b.parent())}else{k.insertAfter(b)}j=j.add(k);bindEvents(k);j.each(function(m){d(this).removeClass("span"+d(this).data("width")).addClass("span"+l[m]).data("width",l[m])});show_toolbox(k)};g.removeColumn=function(){if(!b){return}var r=b,p=r.parent(),s=p.parent().children('[class*="row"]'),m=s.children('[class*="span"]'),u=m.filter(function(){return !d(this).data("module_id")}),q=m.filter(function(){return d(this).data("module_id")}).length,o=p.children('[class*="span"]'),i=o.length-1,t=defaultColumnsWidth(i),k=r.data("module_id")?false:true;if((k&&((!q&&u.length==1)||(q&&u.length==0)))||m.length==1){return}if(k){var l=u.index(r),j=l==0?u[1]:u[l-1];r.find("ul:first > li").appendTo(d(j).find("ul:first"))}var l=m.index(r),n=l==0?m[1]:m[l-1];if(i<1){p.remove()}else{o=o.not(r);o.each(function(v){d(this).removeClass("span"+d(this).data("width")).addClass("span"+t[v]).data("width",t[v])});r.remove()}show_toolbox(d(n))};g.hideWhenCollapse=function(){if(!b){return}var j=toolbox_type();if(j=="sub"){var i=b.closest("li");if(i.data("hidewcol")){i.data("hidewcol",0);i.removeClass("sub-hidden-collapse")}else{i.data("hidewcol",1);i.addClass("sub-hidden-collapse")}}else{if(j=="col"){if(b.data("hidewcol")){b.data("hidewcol",0);b.removeClass("hidden-collapse")}else{b.data("hidewcol",1);b.addClass("hidden-collapse")}}}update_toolbox()};g.saveConfig=function(m){var j={},i=f.find('ul[class*="level"] > li');i.each(function(){var t=d(this),v="item-"+t.data("id"),q={};if(t.hasClass("mega")){var s=t.find(".menu-child:first");q.submenu={};for(var u in s.data()){if(u!="id"&&u!="level"&&s.data(u)){q.submenu[u]=s.data(u)}}var o=s.find('[class*="row"]:first').parent().children('[class*="row"]'),r=[],p=0;o.each(function(){var y=[],x=d(this).children('[class*="span"]'),w=0;x.each(function(){var z=d(this).find('ul[class*="level"] > li:first'),A={};if(z.length){A.item=z.data("id")}else{if(d(this).data("module_id")){A.module_id=d(this).data("module_id")}else{A.item=-1}}for(var B in d(this).data()){if(B!="id"&&B!="level"&&B!="module_id"&&d(this).data(B)){A[B]=d(this).data(B)}}y[w++]=A});r[p++]=y});q.submenu["rows"]=r}for(var u in t.data()){if(u!="id"&&u!="level"&&t.data(u)){if(u=="caption"){q[u]=t.data(u).replace(/</g,"[lt]").replace(/>/g,"[gt]")}else{q[u]=t.data(u)}}}if(Object.keys(q).length){j[v]=q}});var l=d("#jform_params_menu_type").val(),n=d("#jform_params_menu_config"),k=null;try{k=n.val()?d.parseJSON(n.val()):{}}catch(m){k={}}if(d.isArray(k)&&k.length==0){k={}}k[l]=j;n.val(JSON.stringify(k))};toolbox_type=function(){return b.hasClass("menu-child ")?"sub":(b.length>0&&b[0].tagName=="DIV"?"col":"item")};hide_toolbox=function(i){d("#zo2-admin-mm-tb .admin-toolbox").hide();b=null;if(f&&f.data("nav_all")){f.data("nav_all").removeClass("selected")}f.find("li").removeClass("open");if(i){d("#zo2-admin-mm-intro").show()}else{d("#zo2-admin-mm-intro").hide()}};show_toolbox=function(j){hide_toolbox(false);if(j){b=j}f.find('ul[class*="level"] > li').each(function(){if(!d(this).has(b).length>0){d(this).removeClass("open")}else{d(this).addClass("open")}});f.data("nav_all").removeClass("selected");b.addClass("selected");var i=toolbox_type();d("#zo2-admin-mm-tool"+i).show();update_toolbox(i);d("#zo2-admin-mm-tb").show()};update_toolbox=function(l){if(!l){l=toolbox_type()}d("#zo2-admin-mm-tb .disabled").removeClass("disabled");d("#zo2-admin-mm-tb .active").removeClass("active");switch(l){case"item":var j=b.closest("li"),m=j.parent().closest("li"),k=j.find(".menu-child:first");d(".toolitem-exclass").attr("value",j.data("class")||"");d(".toolitem-xicon").attr("value",j.data("xicon")||"");d(".toolitem-caption").attr("value",j.data("caption")||"");var i=d(".toolitem-sub");i.find("label").removeClass("active btn-success btn-danger btn-primary");if(j.data("group")){d(".toolitem-sub").addClass("disabled")}else{if(k.length==0||k.css("display")=="none"){update_toggle(i,0)}else{update_toggle(i,1)}}var i=d(".toolitem-group");i.find("label").removeClass("active btn-success btn-danger btn-primary");if(j.data("level")==1||k.length==0||j.data("hidesub")==1){d(".toolitem-group").addClass("disabled")}else{if(j.data("group")){update_toggle(i,1)}else{update_toggle(i,0)}}if(!m.length||!m.hasClass("mega")){d(".toolitem-moveleft, .toolitem-moveright").addClass("disabled")}break;case"sub":var j=b.closest("li");d(".toolsub-exclass").attr("value",b.data("class")||"");if(j.data("group")){d(".toolsub-width").attr("value","").addClass("disabled");d(".toolitem-alignment").addClass("disabled")}else{d(".toolsub-width").attr("value",b.data("width")||"");if(j.data("level")>1){d(".toolsub-align-center").addClass("disabled");d(".toolsub-align-justify").addClass("disabled")}if(j.data("alignsub")){d(".toolsub-align-"+j.data("alignsub")).addClass("active");if(j.data("alignsub")=="justify"){d(".toolsub-width").addClass("disabled")}}}var i=d(".toolsub-hidewhencollapse");i.find("label").removeClass("active btn-success btn-danger btn-primary");if(j.data("hidewcol")){update_toggle(i,1)}else{update_toggle(i,0)}break;case"col":d(".toolcol-exclass").attr("value",b.data("class")||"");d(".toolcol-module").val(b.data("module_id")||"").trigger("liszt:updated");d(".toolcol-width").val(b.data("width")||"").trigger("liszt:updated");if(b.find(".mega-nav").length>0){d(".toolcol-module").parent().addClass("disabled")}if(b.parent().children().length==1){d(".toolcol-width").parent().addClass("disabled")}var i=d(".toolcol-hidewhencollapse");i.find("label").removeClass("active btn-success btn-danger btn-primary");if(b.data("hidewcol")){update_toggle(i,1)}else{update_toggle(i,0)}break}};update_toggle=function(i,j){$input=i.find('input[value="'+j+'"]');$input.attr("checked","checked");$input.trigger("update")};apply_toolbox=function(i){var j=d(i).data("name"),m=i.value,k=toolbox_type();switch(j){case"width":if(k=="sub"){b.width(m)}if(k=="col"){b.removeClass("span"+b.data(j)).addClass("span"+m)}b.data(j,m);break;case"class":if(k=="item"){var l=b.closest("li")}else{var l=b}l.removeClass(l.data(j)||"").addClass(m);l.data(j,m);break;case"xicon":if(k=="item"){b.closest("li").data(j,m);b.find("i").remove();if(m){b.prepend(d('<i class="'+m+'"></i>'))}}break;case"caption":if(k=="item"){b.closest("li").data(j,m);b.find("span.mega-caption").remove();if(m){b.append(d('<span class="mega-caption">'+m+"</span>"))}}break;case"module_id":if(b.find('ul[class*="level"]').length==0){if(m){d.ajax({url:Assets.url,data:{zo2controller:"module",module_id:m}}).done(function(n){b.find(".mega-inner").html(n).find(":input").removeAttr("name")})}else{b.find(".mega-inner").html("")}b.data(j,m)}break}};defaultColumnsWidth=function(n){if(n<1){return null}var m=12,k=Math.floor(m/n),l=[];for(var j=0;j<n;j++){l[j]=k}l[n-1]=m-k*(n-1);return l};bindEvents=function(i){if(f.data("nav_all")){f.data("nav_all",f.data("nav_all").add(i))}else{f.data("nav_all",i)}i.mouseover(function(j){f.data("nav_all").removeClass("hover");$this=d(this);clearTimeout(f.data("hovertimeout"));f.data("hovertimeout",setTimeout("$this.addClass('hover')",100));j.stopPropagation()});i.mouseout(function(j){clearTimeout(f.data("hovertimeout"));d(this).removeClass("hover")});i.click(function(j){show_toolbox(d(this));j.stopPropagation();return false})};unbindEvents=function(i){f.data("nav_all",f.data("nav_all").not(i));i.unbind("mouseover").unbind("mouseout").unbind("click")};rebindEvents=function(i){unbindEvents(i);bindEvents(i)}}(jQuery);!function(a){a.extend(ZO2AdminMegamenu,{prepare:function(){var b=a("#jform_params_mm_type").closest(".controls");b.append(a("#zo2-admin-megamenu").removeClass("hidden"));if(a("#jform_params_nav_type").val()=="megamenu"){setTimeout(function(){a("#jform_params_menu_type").trigger("change.less")},500)}else{a("#jform_params_nav_type").on("change",function(c){if(a(this).val()=="megamenu"){a("#jform_params_menu_type").trigger("change.less")}})}},megamenu:function(c,e,d,b){a("#zo2-admin-mm-container").html(b).megamenuAdmin().find(":input").removeAttr("name")},initPanel:function(){a("#jform_params_mm_panel").hide()},initPreSubmit:function(){var c=document.adminForm;if(!c){return false}var b=c.onsubmit;c.onsubmit=function(d){a(".toolbox-saveConfig").trigger("click");if(a.isFunction(b)){b()}}},initRadioGroup:function(){if(typeof ZO2Admin!="undefined"){return true}var b=a(".zo2-admin-megamenu");b.find(".radio.btn-group label").addClass("btn");b.find(".btn-group label").unbind("click").click(function(){var d=a(this),c=a("#"+d.attr("for"));if(!c.prop("checked")){d.closest(".btn-group").find("label").removeClass("active btn-success btn-danger btn-primary");d.addClass("active "+(c.val()==""?"btn-primary":(c.val()==0?"btn-danger":"btn-success")));c.prop("checked",true).trigger("change")}});b.on("update","input[type=radio]",function(){if(this.checked){a(this).closest(".btn-group").find("label").removeClass("active btn-success btn-danger btn-primary").filter('[for="'+this.id+'"]').addClass("active "+(a(this).val()==""?"btn-primary":(a(this).val()==0?"btn-danger":"btn-success")))}});b.find(".btn-group input[checked=checked]").each(function(){if(a(this).val()==""){a("label[for="+a(this).attr("id")+"]").addClass("active btn-primary")}else{if(a(this).val()==0){a("label[for="+a(this).attr("id")+"]").addClass("active btn-danger")}else{a("label[for="+a(this).attr("id")+"]").addClass("active btn-success")}}})}});a(window).load(function(){ZO2AdminMegamenu.prepare()});a(document).ready(function(){ZO2AdminMegamenu.initPanel();ZO2AdminMegamenu.initPreSubmit();ZO2AdminMegamenu.initRadioGroup()})}(jQuery);